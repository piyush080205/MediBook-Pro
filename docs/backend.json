{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the MediBook Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number, used for authentication."
        },
        "email": {
          "type": "string",
          "description": "The user's email address (optional).",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The user's role within the system (e.g., 'patient', 'admin')."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "phone",
        "role",
        "createdAt"
      ]
    },
    "Doctor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Doctor",
      "type": "object",
      "description": "Represents a doctor in the MediBook Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Doctor entity."
        },
        "name": {
          "type": "string",
          "description": "The doctor's full name."
        },
        "specialties": {
          "type": "array",
          "description": "An array of medical specialties the doctor practices in.",
          "items": {
            "type": "string"
          }
        },
        "qualifications": {
          "type": "string",
          "description": "The doctor's professional qualifications."
        },
        "yearsExperience": {
          "type": "number",
          "description": "The number of years of experience the doctor has."
        },
        "ratingsAvg": {
          "type": "number",
          "description": "The average rating for the doctor."
        },
        "ratingsCount": {
          "type": "number",
          "description": "The number of ratings the doctor has received."
        },
        "fees": {
          "type": "number",
          "description": "The doctor's consultation fees."
        },
        "clinicIds": {
          "type": "array",
          "description": "References to Clinics. (Relationship: Doctor 1:N Clinic)",
          "items": {
            "type": "string"
          }
        },
        "locationLat": {
          "type": "number",
          "description": "The latitude of the doctor's location."
        },
        "locationLng": {
          "type": "number",
          "description": "The longitude of the doctor's location."
        },
        "address": {
          "type": "string",
          "description": "The doctor's address."
        }
      },
      "required": [
        "id",
        "name",
        "specialties",
        "qualifications",
        "yearsExperience",
        "ratingsAvg",
        "ratingsCount",
        "fees",
        "locationLat",
        "locationLng",
        "address"
      ]
    },
    "Clinic": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Clinic",
      "type": "object",
      "description": "Represents a clinic in the MediBook Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Clinic entity."
        },
        "name": {
          "type": "string",
          "description": "The clinic's name."
        },
        "locationLat": {
          "type": "number",
          "description": "The latitude of the clinic's location."
        },
        "locationLng": {
          "type": "number",
          "description": "The longitude of the clinic's location."
        },
        "address": {
          "type": "string",
          "description": "The clinic's address."
        },
        "contactNumber": {
          "type": "string",
          "description": "The clinic's contact phone number."
        },
        "schedule": {
          "type": "array",
          "description": "The clinic's operating schedule.",
          "items": {
            "type": "string"
          }
        },
        "capacity": {
          "type": "number",
          "description": "The clinic's patient capacity."
        }
      },
      "required": [
        "id",
        "name",
        "locationLat",
        "locationLng",
        "address",
        "contactNumber",
        "schedule",
        "capacity"
      ]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents an appointment booked in the MediBook Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Appointment entity."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to User (Patient). (Relationship: User 1:N Appointment)"
        },
        "doctorId": {
          "type": "string",
          "description": "Reference to Doctor. (Relationship: Doctor 1:N Appointment)"
        },
        "clinicId": {
          "type": "string",
          "description": "Reference to Clinic. (Relationship: Clinic 1:N Appointment)"
        },
        "slotStart": {
          "type": "string",
          "description": "The start time of the appointment slot.",
          "format": "date-time"
        },
        "slotEnd": {
          "type": "string",
          "description": "The end time of the appointment slot.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the appointment (e.g., 'booked', 'cancelled', 'completed')."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the appointment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "patientId",
        "doctorId",
        "clinicId",
        "slotStart",
        "slotEnd",
        "status",
        "createdAt"
      ]
    },
    "TriageLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TriageLog",
      "type": "object",
      "description": "Represents a log entry for a triage assessment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TriageLog entry."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp when the triage assessment was performed.",
          "format": "date-time"
        },
        "symptoms": {
          "type": "array",
          "description": "The symptoms reported by the user.",
          "items": {
            "type": "string"
          }
        },
        "age": {
          "type": "number",
          "description": "The age of the user (optional)."
        },
        "gender": {
          "type": "string",
          "description": "The gender of the user (optional)."
        },
        "recommendedSpecialty": {
          "type": "string",
          "description": "The specialty recommended by the triage engine."
        },
        "urgency": {
          "type": "string",
          "description": "The urgency level determined by the triage engine (e.g., 'low', 'medium', 'high')."
        },
        "confidence": {
          "type": "number",
          "description": "The confidence level of the triage engine's recommendation (0-1)."
        },
        "suggestedNextSteps": {
          "type": "array",
          "description": "Suggested next steps for the user based on the triage assessment.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "timestamp",
        "symptoms",
        "recommendedSpecialty",
        "urgency",
        "confidence",
        "suggestedNextSteps"
      ]
    },
    "SlotOptimizationLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SlotOptimizationLog",
      "type": "object",
      "description": "Represents a log entry for slot optimization attempts.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SlotOptimizationLog entry."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp when the slot optimization was performed.",
          "format": "date-time"
        },
        "doctorId": {
          "type": "string",
          "description": "Reference to Doctor. The doctor ID for which the slot optimization was performed."
        },
        "dateRangeFrom": {
          "type": "string",
          "description": "The start date of the date range for slot optimization.",
          "format": "date-time"
        },
        "dateRangeTo": {
          "type": "string",
          "description": "The end date of the date range for slot optimization.",
          "format": "date-time"
        },
        "patientPreferencesEarliestTime": {
          "type": "string",
          "description": "The earliest time the patient is available (optional).",
          "format": "date-time"
        },
        "patientPreferencesLatestTime": {
          "type": "string",
          "description": "The latest time the patient is available (optional).",
          "format": "date-time"
        },
        "bestSlots": {
          "type": "array",
          "description": "The optimized slot suggestions.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "timestamp",
        "doctorId",
        "dateRangeFrom",
        "dateRangeTo",
        "bestSlots"
      ]
    },
    "QueueHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QueueHistory",
      "type": "object",
      "description": "Represents a historical entry of clinic queue data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the QueueHistory entry."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp when the queue data was recorded.",
          "format": "date-time"
        },
        "clinicId": {
          "type": "string",
          "description": "Reference to Clinic. The clinic ID for which the queue data is recorded."
        },
        "patientsAhead": {
          "type": "number",
          "description": "The number of patients ahead in the queue."
        },
        "estimatedWaitMinutes": {
          "type": "number",
          "description": "The estimated wait time in minutes."
        }
      },
      "required": [
        "id",
        "timestamp",
        "clinicId",
        "patientsAhead",
        "estimatedWaitMinutes"
      ]
    }
  },
  "auth": {
    "providers": [
      "phone",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The 'userId' parameter is the unique identifier for the user. It is also used for path-based authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/doctors/{doctorId}",
        "definition": {
          "entityName": "Doctor",
          "schema": {
            "$ref": "#/backend/entities/Doctor"
          },
          "description": "Stores doctor profiles. Accessible for reading by all users, but write access is restricted to admin roles.",
          "params": [
            {
              "name": "doctorId",
              "description": "The unique identifier of the doctor."
            }
          ]
        }
      },
      {
        "path": "/clinics/{clinicId}",
        "definition": {
          "entityName": "Clinic",
          "schema": {
            "$ref": "#/backend/entities/Clinic"
          },
          "description": "Stores clinic information. Accessible for reading by all users, but write access is restricted to admin roles.",
          "params": [
            {
              "name": "clinicId",
              "description": "The unique identifier of the clinic."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores appointment bookings for a specific user. The 'userId' is denormalized into the appointment document to allow rules to validate the ownership of each `Appointment`",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (patient)."
            },
            {
              "name": "appointmentId",
              "description": "The unique identifier of the appointment."
            }
          ]
        }
      },
      {
        "path": "/triage_logs/{triageLogId}",
        "definition": {
          "entityName": "TriageLog",
          "schema": {
            "$ref": "#/backend/entities/TriageLog"
          },
          "description": "Stores triage log entries. Write access restricted to the application backend.",
          "params": [
            {
              "name": "triageLogId",
              "description": "The unique identifier of the triage log entry."
            }
          ]
        }
      },
      {
        "path": "/slot_optimization_logs/{slotOptimizationLogId}",
        "definition": {
          "entityName": "SlotOptimizationLog",
          "schema": {
            "$ref": "#/backend/entities/SlotOptimizationLog"
          },
          "description": "Stores slot optimization log entries. Write access restricted to the application backend.",
          "params": [
            {
              "name": "slotOptimizationLogId",
              "description": "The unique identifier of the slot optimization log entry."
            }
          ]
        }
      },
      {
        "path": "/queue_history/{queueHistoryId}",
        "definition": {
          "entityName": "QueueHistory",
          "schema": {
            "$ref": "#/backend/entities/QueueHistory"
          },
          "description": "Stores queue history entries for clinics. Write access restricted to the application backend.",
          "params": [
            {
              "name": "queueHistoryId",
              "description": "The unique identifier of the queue history entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the MediBook Pro application's features, including smart triage, doctor search, appointment booking, queue prediction, and emergency routing. The structure emphasizes authorization independence and clear security rules by denormalizing authorization data and segregating data based on access requirements.\n\nAuthorization Independence is achieved by storing the `User.id` on the `Appointment` documents, facilitating direct access control based on the currently logged in user.\n\nQAPs (Rules Are Not Filters) is supported through structural segregation. User-specific data (appointments) is stored under the `/users/{userId}` path, enabling secure list operations based on path-based ownership. Doctor and Clinic data, while globally accessible for reading, are managed via backend processes and do not require filtering on the client side. Global roles (e.g. admin) are not explicitly modeled in this structure as they are out of scope."
  }
}