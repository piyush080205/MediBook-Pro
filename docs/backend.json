{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the MediBook Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number, used for authentication."
        },
        "email": {
          "type": "string",
          "description": "The user's email address (optional).",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The user's role within the system (e.g., 'patient', 'admin')."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the user account was created.",
          "format": "date-time"
        },
        "chronicFlags": {
            "type": "array",
            "description": "A list of chronic conditions the user has.",
            "items": { "type": "string" }
        },
        "healthWallet": {
            "type": "object",
            "description": "Contains user's health records.",
            "properties": {
                "prescriptions": { "type": "array", "items": { "type": "string" } },
                "labReports": { "type": "array", "items": { "type": "string" } },
                "vaccinationReminders": { "type": "array", "items": { "type": "string" } },
                "insuranceCardUrl": { "type": "string" }
            }
        }
      },
      "required": [
        "id",
        "name",
        "phone",
        "role",
        "createdAt"
      ]
    },
    "Doctor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Doctor",
      "type": "object",
      "description": "Represents a doctor in the MediBook Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Doctor entity."
        },
        "name": {
          "type": "string",
          "description": "The doctor's full name."
        },
        "specialties": {
          "type": "array",
          "description": "An array of medical specialties the doctor practices in.",
          "items": {
            "type": "string"
          }
        },
        "qualifications": {
          "type": "string",
          "description": "The doctor's professional qualifications."
        },
        "yearsExperience": {
          "type": "number",
          "description": "The number of years of experience the doctor has."
        },
        "ratings": {
            "type": "object",
            "properties": {
                "avg": { "type": "number" },
                "count": { "type": "number" }
            }
        },
        "fees": {
          "type": "number",
          "description": "The doctor's consultation fees."
        },
        "clinicIds": {
          "type": "array",
          "description": "References to Clinics. (Relationship: Doctor 1:N Clinic)",
          "items": {
            "type": "string"
          }
        },
        "languages": {
            "type": "array",
            "description": "Languages spoken by the doctor.",
            "items": { "type": "string" }
        },
        "schedule": {
            "type": "array",
            "description": "The doctor's working schedule.",
            "items": { "type": "object" }
        },
        "performance": {
            "type": "object",
            "description": "Doctor's performance metrics.",
            "properties": {
                "avgDuration": { "type": "number" },
                "noShowRate": { "type": "number" }
            }
        }
      },
      "required": [
        "id",
        "name",
        "specialties",
        "qualifications",
        "yearsExperience",
        "ratings",
        "fees"
      ]
    },
    "Clinic": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Clinic",
      "type": "object",
      "description": "Represents a clinic in the MediBook Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Clinic entity."
        },
        "name": {
          "type": "string",
          "description": "The clinic's name."
        },
        "location": {
            "type": "object",
            "properties": {
                "lat": { "type": "number" },
                "lng": { "type": "number" },
                "address": { "type": "string" }
            }
        },
        "contactNumber": {
          "type": "string",
          "description": "The clinic's contact phone number."
        },
        "schedule": {
          "type": "array",
          "description": "The clinic's operating schedule.",
          "items": {
            "type": "object"
          }
        },
        "capacity": {
          "type": "number",
          "description": "The clinic's patient capacity."
        },
        "isER": {
            "type": "boolean",
            "description": "Whether the clinic is an Emergency Room."
        }
      },
      "required": [
        "id",
        "name",
        "location",
        "contactNumber",
        "schedule",
        "capacity"
      ]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents an appointment booked in the MediBook Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Appointment entity."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to User (Patient). (Relationship: User 1:N Appointment)"
        },
        "doctorId": {
          "type": "string",
          "description": "Reference to Doctor. (Relationship: Doctor 1:N Appointment)"
        },
        "clinicId": {
          "type": "string",
          "description": "Reference to Clinic. (Relationship: Clinic 1:N Appointment)"
        },
        "slot": {
          "type": "object",
          "properties": {
            "start": { "type": "string", "format": "date-time" },
            "end": { "type": "string", "format": "date-time" }
          }
        },
        "status": {
          "type": "string",
          "description": "The status of the appointment (e.g., 'booked', 'cancelled', 'completed')."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the appointment was created.",
          "format": "date-time"
        },
        "cancelledAt": {
            "type": "string",
            "description": "The timestamp when the appointment was cancelled.",
            "format": "date-time"
        }
      },
      "required": [
        "id",
        "patientId",
        "doctorId",
        "clinicId",
        "slot",
        "status",
        "createdAt"
      ]
    },
    "TriageLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TriageLog",
      "type": "object",
      "description": "Represents a log entry for a triage assessment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TriageLog entry."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp when the triage assessment was performed.",
          "format": "date-time"
        },
        "symptoms": {
          "type": "array",
          "description": "The symptoms reported by the user.",
          "items": {
            "type": "string"
          }
        },
        "age": {
          "type": "number",
          "description": "The age of the user (optional)."
        },
        "gender": {
          "type": "string",
          "description": "The gender of the user (optional)."
        },
        "recommendedSpecialty": {
          "type": "string",
          "description": "The specialty recommended by the triage engine."
        },
        "urgency": {
          "type": "string",
          "description": "The urgency level determined by the triage engine (e.g., 'low', 'medium', 'high')."
        },
        "riskScore": { "type": "number" },
        "riskCategory": { "type": "string", "enum": ["low", "medium", "high"] },
        "contributingFactors": { "type": "array", "items": { "type": "string" } },
        "explanation": { "type": "array", "items": { "type": "string" } }
      },
      "required": [
        "id",
        "timestamp",
        "symptoms",
        "recommendedSpecialty",
        "urgency",
        "riskScore",
        "riskCategory",
        "explanation"
      ]
    },
    "LoadBalancerLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LoadBalancerLog",
      "description": "Logs recommendations from the doctor load balancer.",
      "type": "object",
      "properties": {
          "id": { "type": "string" },
          "timestamp": { "type": "string", "format": "date-time" },
          "recommendations": { "type": "array", "items": { "type": "object" } }
      }
    },
    "QueueHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QueueHistory",
      "type": "object",
      "description": "Represents a historical entry of clinic queue data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the QueueHistory entry."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp when the queue data was recorded.",
          "format": "date-time"
        },
        "clinicId": {
          "type": "string",
          "description": "Reference to Clinic. The clinic ID for which the queue data is recorded."
        },
        "patientsAhead": {
          "type": "number",
          "description": "The number of patients ahead in the queue."
        },
        "estimatedWaitMinutes": {
          "type": "number",
          "description": "The estimated wait time in minutes."
        }
      },
      "required": [
        "id",
        "timestamp",
        "clinicId",
        "patientsAhead",
        "estimatedWaitMinutes"
      ]
    },
    "OCRResult": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "OCRResult",
        "description": "Stores the result of a prescription OCR scan.",
        "type": "object",
        "properties": {
            "id": { "type": "string" },
            "userId": { "type": "string" },
            "timestamp": { "type": "string", "format": "date-time" },
            "originalText": { "type": "string" },
            "extractedMedicines": { "type": "array", "items": { "type": "string" } },
            "suggestedSpecialties": { "type": "array", "items": { "type": "string" } }
        }
    },
    "RescheduleLog": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "RescheduleLog",
        "description": "Logs actions from the auto-reschedule brain.",
        "type": "object",
        "properties": {
            "id": { "type": "string" },
            "originalAppointmentId": { "type": "string" },
            "patientId": { "type": "string" },
            "offeredSlots": { "type": "array", "items": { "type": "object" } },
            "status": { "type": "string", "enum": ["offered", "accepted", "ignored"] }
        }
    }
  },
  "auth": {
    "providers": [
      "phone",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "schema": {
            "$ref": "#/entities/User"
          },
          "description": "Stores user profiles."
        }
      },
      {
        "path": "/doctors/{doctorId}",
        "definition": {
          "schema": {
            "$ref": "#/entities/Doctor"
          },
          "description": "Stores doctor profiles."
        }
      },
      {
        "path": "/clinics/{clinicId}",
        "definition": {
          "schema": {
            "$ref": "#/entities/Clinic"
          },
          "description": "Stores clinic information."
        }
      },
      {
        "path": "/users/{userId}/appointments/{appointmentId}",
        "definition": {
          "schema": {
            "$ref": "#/entities/Appointment"
          },
          "description": "Stores appointment bookings for a specific user."
        }
      },
      {
        "path": "/triage_logs/{triageLogId}",
        "definition": {
          "schema": {
            "$ref": "#/entities/TriageLog"
          },
          "description": "Stores triage log entries."
        }
      },
      {
        "path": "/load_balancer_logs/{logId}",
        "definition": {
          "schema": { "$ref": "#/entities/LoadBalancerLog" },
          "description": "Logs for the doctor load balancer."
        }
      },
      {
        "path": "/queue_history/{queueHistoryId}",
        "definition": {
          "schema": {
            "$ref": "#/entities/QueueHistory"
          },
          "description": "Stores queue history entries for clinics."
        }
      },
      {
        "path": "/ocr_results/{resultId}",
        "definition": {
            "schema": { "$ref": "#/entities/OCRResult" },
            "description": "Stores prescription OCR scan results."
        }
      },
      {
        "path": "/reschedule_logs/{logId}",
        "definition": {
            "schema": { "$ref": "#/entities/RescheduleLog" },
            "description": "Logs for the auto-rescheduler."
        }
      }
    ],
    "reasoning": "The data structure is updated to support the full Patient Safety Suite. It includes new collections for logging various operational processes like triage, load balancing, and rescheduling. Existing entities like User and Doctor are expanded with new fields (e.g., `healthWallet`, `performance`) as required by the new features. Security rules will be configured to restrict write access on log collections to backend processes, ensuring data integrity."
  }
}
    